import{i as M}from"./@react-dnd-M5BQnCw1.js";var l;(function(s){s.mouse="mouse",s.touch="touch",s.keyboard="keyboard"})(l||(l={}));class N{get delay(){var e;return(e=this.args.delay)!==null&&e!==void 0?e:0}get scrollAngleRanges(){return this.args.scrollAngleRanges}get getDropTargetElementsAtPoint(){return this.args.getDropTargetElementsAtPoint}get ignoreContextMenu(){var e;return(e=this.args.ignoreContextMenu)!==null&&e!==void 0?e:!1}get enableHoverOutsideTarget(){var e;return(e=this.args.enableHoverOutsideTarget)!==null&&e!==void 0?e:!1}get enableKeyboardEvents(){var e;return(e=this.args.enableKeyboardEvents)!==null&&e!==void 0?e:!1}get enableMouseEvents(){var e;return(e=this.args.enableMouseEvents)!==null&&e!==void 0?e:!1}get enableTouchEvents(){var e;return(e=this.args.enableTouchEvents)!==null&&e!==void 0?e:!0}get touchSlop(){return this.args.touchSlop||0}get delayTouchStart(){var e,o,n,t;return(t=(n=(e=this.args)===null||e===void 0?void 0:e.delayTouchStart)!==null&&n!==void 0?n:(o=this.args)===null||o===void 0?void 0:o.delay)!==null&&t!==void 0?t:0}get delayMouseStart(){var e,o,n,t;return(t=(n=(e=this.args)===null||e===void 0?void 0:e.delayMouseStart)!==null&&n!==void 0?n:(o=this.args)===null||o===void 0?void 0:o.delay)!==null&&t!==void 0?t:0}get window(){if(this.context&&this.context.window)return this.context.window;if(typeof window<"u")return window}get document(){var e;if(!((e=this.context)===null||e===void 0)&&e.document)return this.context.document;if(this.window)return this.window.document}get rootElement(){var e;return((e=this.args)===null||e===void 0?void 0:e.rootElement)||this.document}constructor(e,o){this.args=e,this.context=o}}function w(s,e,o,n){return Math.sqrt(Math.pow(Math.abs(o-s),2)+Math.pow(Math.abs(n-e),2))}function C(s,e,o,n,t){if(!t)return!1;const i=Math.atan2(n-e,o-s)*180/Math.PI+180;for(let a=0;a<t.length;++a){const r=t[a];if(r&&(r.start==null||i>=r.start)&&(r.end==null||i<=r.end))return!0}return!1}const x={Left:1},D={Left:0};function b(s){return s.button===void 0||s.button===D.Left}function L(s){return s.buttons===void 0||(s.buttons&x.Left)===0}function y(s){return!!s.targetTouches}const P=1;function _(s){const e=s.nodeType===P?s:s.parentElement;if(!e)return;const{top:o,left:n}=e.getBoundingClientRect();return{x:n,y:o}}function k(s,e){if(s.targetTouches.length===1)return S(s.targetTouches[0]);if(e&&s.touches.length===1&&s.touches[0].target===e.target)return S(s.touches[0])}function S(s,e){return y(s)?k(s,e):{x:s.clientX,y:s.clientY}}const T=(()=>{let s=!1;try{addEventListener("test",()=>{},Object.defineProperty({},"passive",{get(){return s=!0,!0}}))}catch{}return s})(),v={[l.mouse]:{start:"mousedown",move:"mousemove",end:"mouseup",contextmenu:"contextmenu"},[l.touch]:{start:"touchstart",move:"touchmove",end:"touchend"},[l.keyboard]:{keydown:"keydown"}};class f{profile(){var e;return{sourceNodes:this.sourceNodes.size,sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,targetNodes:this.targetNodes.size,dragOverTargetIds:((e=this.dragOverTargetIds)===null||e===void 0?void 0:e.length)||0}}get document(){return this.options.document}setup(){const e=this.options.rootElement;e&&(M(!f.isSetUp,"Cannot have two Touch backends at the same time."),f.isSetUp=!0,this.addEventListener(e,"start",this.getTopMoveStartHandler()),this.addEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.addEventListener(e,"move",this.handleTopMove),this.addEventListener(e,"move",this.handleTopMoveCapture,!0),this.addEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.addEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.addEventListener(e,"keydown",this.handleCancelOnEscape,!0))}teardown(){const e=this.options.rootElement;e&&(f.isSetUp=!1,this._mouseClientOffset={},this.removeEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.removeEventListener(e,"start",this.handleTopMoveStart),this.removeEventListener(e,"move",this.handleTopMoveCapture,!0),this.removeEventListener(e,"move",this.handleTopMove),this.removeEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.removeEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.removeEventListener(e,"keydown",this.handleCancelOnEscape,!0),this.uninstallSourceNodeRemovalObserver())}addEventListener(e,o,n,t=!1){const i=T?{capture:t,passive:!1}:t;this.listenerTypes.forEach(function(a){const r=v[a][o];r&&e.addEventListener(r,n,i)})}removeEventListener(e,o,n,t=!1){const i=T?{capture:t,passive:!1}:t;this.listenerTypes.forEach(function(a){const r=v[a][o];r&&e.removeEventListener(r,n,i)})}connectDragSource(e,o){const n=this.handleMoveStart.bind(this,e);return this.sourceNodes.set(e,o),this.addEventListener(o,"start",n),()=>{this.sourceNodes.delete(e),this.removeEventListener(o,"start",n)}}connectDragPreview(e,o,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,o),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDropTarget(e,o){const n=this.options.rootElement;if(!this.document||!n)return()=>{};const t=i=>{if(!this.document||!n||!this.monitor.isDragging())return;let a;switch(i.type){case v.mouse.move:a={x:i.clientX,y:i.clientY};break;case v.touch.move:var r,d;a={x:((r=i.touches[0])===null||r===void 0?void 0:r.clientX)||0,y:((d=i.touches[0])===null||d===void 0?void 0:d.clientY)||0};break}const c=a!=null?this.document.elementFromPoint(a.x,a.y):void 0,g=c&&o.contains(c);if(c===o||g)return this.handleMove(i,e)};return this.addEventListener(this.document.body,"move",t),this.targetNodes.set(e,o),()=>{this.document&&(this.targetNodes.delete(e),this.removeEventListener(this.document.body,"move",t))}}getTopMoveStartHandler(){return!this.options.delayTouchStart&&!this.options.delayMouseStart?this.handleTopMoveStart:this.handleTopMoveStartDelay}installSourceNodeRemovalObserver(e){this.uninstallSourceNodeRemovalObserver(),this.draggedSourceNode=e,this.draggedSourceNodeRemovalObserver=new MutationObserver(()=>{e&&!e.parentElement&&(this.resurrectSourceNode(),this.uninstallSourceNodeRemovalObserver())}),!(!e||!e.parentElement)&&this.draggedSourceNodeRemovalObserver.observe(e.parentElement,{childList:!0})}resurrectSourceNode(){this.document&&this.draggedSourceNode&&(this.draggedSourceNode.style.display="none",this.draggedSourceNode.removeAttribute("data-reactid"),this.document.body.appendChild(this.draggedSourceNode))}uninstallSourceNodeRemovalObserver(){this.draggedSourceNodeRemovalObserver&&this.draggedSourceNodeRemovalObserver.disconnect(),this.draggedSourceNodeRemovalObserver=void 0,this.draggedSourceNode=void 0}constructor(e,o,n){this.getSourceClientOffset=t=>{const i=this.sourceNodes.get(t);return i&&_(i)},this.handleTopMoveStartCapture=t=>{b(t)&&(this.moveStartSourceIds=[])},this.handleMoveStart=t=>{Array.isArray(this.moveStartSourceIds)&&this.moveStartSourceIds.unshift(t)},this.handleTopMoveStart=t=>{if(!b(t))return;const i=S(t);i&&(y(t)&&(this.lastTargetTouchFallback=t.targetTouches[0]),this._mouseClientOffset=i),this.waitingForDelay=!1},this.handleTopMoveStartDelay=t=>{if(!b(t))return;const i=t.type===v.touch.start?this.options.delayTouchStart:this.options.delayMouseStart;this.timeout=setTimeout(this.handleTopMoveStart.bind(this,t),i),this.waitingForDelay=!0},this.handleTopMoveCapture=()=>{this.dragOverTargetIds=[]},this.handleMove=(t,i)=>{this.dragOverTargetIds&&this.dragOverTargetIds.unshift(i)},this.handleTopMove=t=>{if(this.timeout&&clearTimeout(this.timeout),!this.document||this.waitingForDelay)return;const{moveStartSourceIds:i,dragOverTargetIds:a}=this,r=this.options.enableHoverOutsideTarget,d=S(t,this.lastTargetTouchFallback);if(!d)return;if(this._isScrolling||!this.monitor.isDragging()&&C(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,d.x,d.y,this.options.scrollAngleRanges)){this._isScrolling=!0;return}if(!this.monitor.isDragging()&&this._mouseClientOffset.hasOwnProperty("x")&&i&&w(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,d.x,d.y)>(this.options.touchSlop?this.options.touchSlop:0)&&(this.moveStartSourceIds=void 0,this.actions.beginDrag(i,{clientOffset:this._mouseClientOffset,getSourceClientOffset:this.getSourceClientOffset,publishSource:!1})),!this.monitor.isDragging())return;const c=this.sourceNodes.get(this.monitor.getSourceId());this.installSourceNodeRemovalObserver(c),this.actions.publishDragSource(),t.cancelable&&t.preventDefault();const g=(a||[]).map(u=>this.targetNodes.get(u)).filter(u=>!!u),E=this.options.getDropTargetElementsAtPoint?this.options.getDropTargetElementsAtPoint(d.x,d.y,g):this.document.elementsFromPoint(d.x,d.y),p=[];for(const u in E){if(!E.hasOwnProperty(u))continue;let h=E[u];for(h!=null&&p.push(h);h;)h=h.parentElement,h&&p.indexOf(h)===-1&&p.push(h)}const m=p.filter(u=>g.indexOf(u)>-1).map(u=>this._getDropTargetId(u)).filter(u=>!!u).filter((u,h,O)=>O.indexOf(u)===h);if(r)for(const u in this.targetNodes){const h=this.targetNodes.get(u);if(c&&h&&h.contains(c)&&m.indexOf(u)===-1){m.unshift(u);break}}m.reverse(),this.actions.hover(m,{clientOffset:d})},this._getDropTargetId=t=>{const i=this.targetNodes.keys();let a=i.next();for(;a.done===!1;){const r=a.value;if(t===this.targetNodes.get(r))return r;a=i.next()}},this.handleTopMoveEndCapture=t=>{if(this._isScrolling=!1,this.lastTargetTouchFallback=void 0,!!L(t)){if(!this.monitor.isDragging()||this.monitor.didDrop()){this.moveStartSourceIds=void 0;return}t.cancelable&&t.preventDefault(),this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.drop(),this.actions.endDrag()}},this.handleCancelOnEscape=t=>{t.key==="Escape"&&this.monitor.isDragging()&&(this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.endDrag())},this.options=new N(n,o),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this.listenerTypes=[],this._mouseClientOffset={},this._isScrolling=!1,this.options.enableMouseEvents&&this.listenerTypes.push(l.mouse),this.options.enableTouchEvents&&this.listenerTypes.push(l.touch),this.options.enableKeyboardEvents&&this.listenerTypes.push(l.keyboard)}}const A=function(e,o={},n={}){return new f(e,o,n)};export{A as T};
